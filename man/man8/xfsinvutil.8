.TH xfsinvutil 8
.SH NAME
xfsinvutil \- \&xfsdump inventory database checking and pruning utility
.SH SYNOPSIS
.nf
\f3xfsinvutil\f1 [\-F|\-i] [\-u \f2UUID\f1] [\-M \f2mount_point\f1]
		 [\-m \f2media_label\f1] \f2mm/dd/yyyy\f1
\f3xfsinvutil\f1 \-i
\f3xfsinvutil\f1 \-C
.fi
.SH DESCRIPTION
.I xfsdump 
maintains an online dump inventory in \f2/var/lib/xfsdump/inventory\f1.
The
.B \-I
option of xfsdump displays the inventory contents hierarchically.
The levels of the hierarchy are:
filesystem,
dump session,
stream, and
media file.
.P
Over time, this database may grow too large as
.I xfsdump (8)
and
.IR xfsrestore (8)
do not remove entries from the inventory. The database may also develop
inconsistencies for various reasons such as operator errors etc., 
that may cause
.I xfsdump
or
.I xfsrestore
to print error or warning messages.
.P
.I xfsinvutil 
is an utility to check this inventory database for consistency,
to remove entries of dump sessions which may no longer be of
relevance, and to browse the contents of the inventory.
.P
.I xfsinvutil
may be used in three different modes.  In the first mode
.I xfsinvutil
steps over each dump session recorded in the inventory and prompts for
a yes or no response to whether each session should be pruned.  The
second is a batch mode in which
.I xfsinvutil
will prune every entry matching the supplied criteria.  The third mode
allows the user to browse the inventory in detail, to delete or
undelete records at will and also to import inventories from other
hosts.
.P
The following command line options are available:
.P
.TP 5
\f3\-F\f1
Don't prompt the operator.  When
.I xfsinvutil
encounters a matching dump session,
.I xfsinvutil
will normally ask the operator for permission to delete the
entry. With this option the deletion is performed, no questions asked.
.TP 5
\f3\-i\f1
Interactive mode.  Causes
.I xfsinvutil
to run in a mode that will allow the operator to browse the contents of
the inventory. Please refer to the
.B "Interactive Mode"
section below for more information.
.TP 5
\f3\-M\f1 \f2mount_point mm/dd/yyyy\f1
Specifies the mount point and cut-off date of inventory entries to
be selected for pruning.  
.I xfsinvutil
prompts the operator when a dump session in the inventory is
identified by the mount point and was created prior to the specified
date.
The operator can then select specific dump sessions for removal from
the inventory database.
This prompt will not happen if the \f3\-n\f1 option is used; it will
be assumed that the pruning is wanted.
.I xfsinvutil 
also performs consistency checks on other inventory database entries when
invoked with this option. 
.RS
.PP
The \f2mountpoint\f1 must match the mount point as specified in
the inventory shown using
.I xfsdump
with the \f3\-I\f1 option.
This includes the host name and the mount path.
.RE
.TP 5
\f3\-u\f1 \f2UUID\f1
Specifies the filesystem universally unique identifier (UUID) of
inventory entries to be selected for pruning.  This option is
equivalent to the \f3\-M\f1 option.
.TP 5
\f3\-m\f1 \f2media_label\f1
If specified, only sessions with at least one media file whose label
matches this value will be eligible for pruning.  This restriction is
in addition to those imposed by the date and the \f3\-M\f1 or
\f3\-u\f1 options.  This option allows the pruning of all inventory
references to media which may have been overwritten or lost. Note that
this option does not apply to sessions with no media files.
.TP 5
.B \-n
With this option, 
.I xfsinvutil 
will not ask any confirmation questions regarding sessions to prune.
(It is the "Nike" option).
.TP 5
.B \-C
With this option, 
.I xfsinvutil 
performs consistency checks for all entries in the inventory database.
It fixes any problems found. If no consistent entries are found , the
corresponding inventory database file is removed.
.SS Interactive Mode
When run with \f3-i\f1,
.I xfsinvutil
will present the operator with a hierarchical representation of the
.I xfsdump
inventory.  In this mode, the operator can use the arrow keys (or
the 
.B h
.B j
.B k
.B l
keys)
to navigate the inventory and also use the following keys and
functionality:
.TP 5
\f3+\f1
Expand a branch of the tree.
.TP 5
\f3-\f1
Collapse a branch of the tree.
.TP 5
\f3*\f1
Fully expand a branch of the tree.
.TP 5
\f3%\f1
Fully collapse a branch of the tree.
.TP 5
\f3h\f1
Move selection to the parent entry.
.TP 5
\f3l\f1
Move selection to the child entry.
.TP 5
\f3j\f1
Move selection to next entry.
.TP 5
\f3k\f1
Move selection to previous entry.
.TP 5
\f3d\f1
Mark the current record, and all sub-records, to be deleted.
.TP 5
\f3u\f1
Clear the current record and all parent records from being deleted.
.TP 5
\f3i\f1
Import another
.I xfsdump
inventory.
.TP 5
\f3?\f1
Show help window.
.TP 5
\f3x\f1
Commit any changes made to the inventory, and exit the program.
.TP 5
\f3q\f1
Exit the program without committing any changes to the inventory.
.P
Inventories from other hosts can be imported to create a larger common
inventory.  It is recommended that the contents of 
.I /var/lib/xfsdump/inventory
on the remote host be copied to a temporary local directory prior to
running
.IR xfsinvutil .
When
.I xfsinvutil
is run in interactive mode, and the operator hits
.BR i ,
they will be prompted for the path to the inventory to be imported.
.I xfsinvutil
will then add the contents of the imported inventory to the main
window, and all entries will be marked as imported.  The operator can
then delete any of these entries that are not to be imported.  When the
operator commits the changes,
.I xfsinvutil
will import any entries which were not marked as deleted.  Deleted entries are
not actually deleted from the original imported inventory.
.SH NOTES
.SS Inventory
Each dump session updates an inventory database in \f2/var/lib/xfsdump/inventory\f1.
.I xfsdump
uses the inventory to determine the base of incremental
and resumed dumps.
.P
This database can be displayed by invoking
.I xfsdump
with the
.B \-I
option.
The display uses tabbed indentation to present the inventory
hierarchically.
The first level is filesystem.
The second level is session.
The third level is media stream (currently only one stream is supported).
The fourth level lists the media files sequentially composing the stream.
.SH FILES
.TP 25
/var/lib/xfsdump/inventory
dump inventory database
.SH SEE ALSO
xfsdump(8),
xfsrestore(8).
